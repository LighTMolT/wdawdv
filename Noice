local Global = (getgenv and getgenv()) or getfenv(0) or _G
if not Global.KryptonReanimateConfig then
	Global.KryptonReanimateConfig = {}
end
if Global.KryptonReanimateLoaded then return end
local LoadSpeed = tick()
local CFN = CFrame.new
local CFA = CFrame.Angles
local Cos = math.cos
local Sin = math.sin
local Random = math.random
local Clock = os.clock
local V3N = Vector3.new
local TInsert = table.insert
local TRemove = table.remove
local TFind = table.find
local Wait = task.wait
local Delay = task.delay
local Spawn = task.spawn
local Defer = task.defer
local IN = Instance.new
local Handles, Events = {}, {}
local Rad = math.rad
local CF0 = CFN(0,0,0)
local V30 = V3N(0,0,0)
local CalculatedY = 30
local AntiSleepOffset, RotVelocityOffset, DiedEvent = CF0, V30, nil

local IsPartOwned = isnetworkowner or function(a) return a.ReceiveAge == 0 end
local SetHiddenProp = sethiddenproperty or function(a,b,c) pcall(function() a[b]=c end) end
local CI = function(ClassName, Info) local Inst = IN(ClassName) for i, v in pairs(Info) do Inst[i]=v end return Inst end

local ReanimSettings; do -- [[ Check Settings | inspired by zendey reanimate ]] --
	if not Global.KryptonReanimateConfig then Global.KryptonReanimateConfig = {} end
	ReanimSettings = Global.KryptonReanimateConfig
	Global.FlingOnHold = true
	if not Global.KryptonData then
		Global.KryptonData = { -- please do not bother editing any of this
			['Script Stopped'] = false,
			['Script Running'] = false,
			['Rig Changed'] = false, -- upcoming
			['Global Events'] = {},
			['Hat Folder'] = IN("Folder"),
			['Fling Part'] = nil,
		}
	end

	local function CheckSettings(Setting, DefaultValue)
		if not ReanimSettings[Setting] then
			ReanimSettings[Setting] = DefaultValue
		end
	end

	local function CheckHat(Hat, DefaultValue)
		if ReanimSettings.DefinedHats and (not ReanimSettings.DefinedHats[Hat]) then
			ReanimSettings.DefinedHats[Hat] = DefaultValue 
		end
	end

	-- Antis | Solvers
	CheckSettings("AntiSleep", true) -- done (better stability)
	CheckSettings("AntiVoid", true) -- done (avoids dying by void)
	CheckSettings("AntiVoidOffset", 75) -- done (offset (fallenpartsdestroyheight + this)

	-- Fling
	CheckSettings("FlingEnabled", false) -- done (tool fling)
	CheckSettings("MouseFlingOnceReanimated", false) -- done (automatic + prediction flinging)

	-- Velocity / Claiming
	CheckSettings("VelocityMultiply", 5) -- multiples velocity, recommended: 5
	CheckSettings("PhysicsTweaks", true) -- enables settings() tweaks and some sethiddenprops

	-- Rig Settings
	CheckSettings("NoClip", false) -- done (allows to walk through parts)
	CheckSettings("RemoveBodyParts", true) -- done (keeps bodyparts, not really stable!!!)
	CheckSettings("R15Reanimation", false) -- r15 reanimate
	-- Misc
	CheckSettings("OldRunServices", false) -- done (old runservices just in case roblox disables the new)
	CheckSettings("FastLoad", false) -- done (faster loads, might be unstable in some scenarios)
	CheckSettings("Animations", true) -- done (base roblox anims)
	CheckSettings("LocalScriptSupport", false) -- makes the script work on localscripts

	-- Funnies
	CheckSettings("BulletEffects", false) -- bullet effect
	CheckSettings("thesounds", false) -- just, dont.
	CheckSettings("Workspace.AntiSleep", false) -- gelatek reanimate type antisleep
	CheckSettings("LeaningAnims", false) -- gelatek reanimate type antisleep

	-- Hat Checks -- done

	CheckSettings("DefinedHats", {})
	CheckHat(1, {'rbxassetid://6963024829', CF0, CF0, true}) -- tors1
	CheckHat(2, {'rbxassetid://0', CF0, CF0, false}) -- tors0
	CheckHat(3, {'rbxassetid://11449388499', CF0, CFA(Rad(-125), 0, 0), true}) -- ra
	CheckHat(4, {'rbxassetid://11449386931', CF0, CFA(Rad(-125), 0, 0), true}) -- la
	CheckHat(5, {'rbxassetid://11159370334', CF0, CFA(0, Rad(-90), Rad(90)), true}) -- rl
	CheckHat(6, {'rbxassetid://11263221350', CF0, CFA(0, Rad(-90), Rad(90)), true}) -- ll
end

local KryptonData = Global.KryptonData
local Workspace = game:FindFirstChildOfClass("Workspace")
local Camera = Workspace.CurrentCamera
local RunService = game:FindFirstChildOfClass("RunService")
local Players = game:FindFirstChildOfClass("Players")
local InsertService = game:FindFirstChildOfClass("InsertService")
local Stats = game:FindFirstChildOfClass("Stats")

local LocalPlayer = Players.LocalPlayer
local RealRig = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local RealRoot = RealRig:WaitForChild("HumanoidRootPart", 20) or RealRig.PrimaryPart
local Humanoid = RealRig:FindFirstChildOfClass("Humanoid")

local PostSimulation = RunService[ReanimSettings.OldRunServices and "Heartbeat" or "PostSimulation"]
local PreSimulation = RunService[ReanimSettings.OldRunServices and "Stepped" or "PreSimulation"]
local WaitTime = Players.RespawnTime + (ReanimSettings.LocalScriptSupport == true and 0.65 or Stats.Network.ServerStatsItem["Data Ping"]:GetValue()/750)

local RealRigDescendants = RealRig:GetDescendants()
local FakeHum, FakeRoot, FakeRigDescendants
if not KryptonData.R6Rig then
	KryptonData.R6Rig = IN("Model"); do
		local FakeRig = KryptonData.R6Rig
		local FakeHead = CI("Part", {Name = "Head", Size = V3N(2, 1, 1), Transparency = 1, Parent = FakeRig});
		local FakeRoot = CI("Part", {Name = "HumanoidRootPart", Size = V3N(2, 2, 1), Transparency = 1, Parent = FakeRig})
		local FakeTorso = CI("Part", {Name = "Torso", Size = V3N(2, 2, 1), Transparency = 1, Parent = FakeRig})
		local FakeRightArm = CI("Part", {Name = "Right Arm", Size = V3N(1, 2, 1), Transparency = 1, Parent = FakeRig})
		local FakeLeftArm = CI("Part", {Name = "Left Arm", Size = V3N(1, 2, 1), Transparency = 1, Parent = FakeRig})
		local FakeRightLeg = CI("Part", {Name = "Right Leg", Size = V3N(1, 2, 1), Transparency = 1, Parent = FakeRig})
		local FakeLeftLeg = CI("Part", {Name = "Left Leg", Size = V3N(1, 2, 1),Transparency = 1, Parent = FakeRig})
		local FakeHum = CI("Humanoid", {DisplayDistanceType = Enum.HumanoidDisplayDistanceType.None, Parent = FakeRig})
		CI("Motor6D", {Name = "Neck", Part0 = FakeTorso, Part1 = FakeHead, C0 = CFN(0, 1, 0, -1, 0, 0, 0, 0, 1, 0, 1, -0), C1 = CFN(0, -0.5, 0, -1, 0, 0, 0, 0, 1, 0, 1, -0), Parent = FakeTorso})
		CI("Motor6D", {Name = "RootJoint", Part0 = FakeRoot, Part1 = FakeTorso, C0 = CFN(0, 0, 0, -1, 0, 0, 0, 0, 1, 0, 1, -0), C1 = CFN(0, 0, 0, -1, 0, 0, 0, 0, 1, 0, 1, -0), Parent = FakeRoot})
		CI("Motor6D", {Name = "Right Shoulder", Part0 = FakeTorso, Part1 = FakeRightArm, C0 = CFN(1, 0.5, 0, 0, 0, 1, 0, 1, -0, -1, 0, 0), C1 = CFN(-0.5, 0.5, 0, 0, 0, 1, 0, 1, -0, -1, 0, 0), Parent = FakeTorso})
		CI("Motor6D", {Name = "Left Shoulder", Part0 = FakeTorso, Part1 = FakeLeftArm, C0 = CFN(-1, 0.5, 0, 0, 0, -1, 0, 1, 0, 1, 0, 0), C1 = CFN(0.5, 0.5, 0, 0, 0, -1, 0, 1, 0, 1, 0, 0), Parent = FakeTorso})
		CI("Motor6D", {Name = "Right Hip", Part0 = FakeTorso, Part1 = FakeRightLeg, C0 = CFN(1, -1, 0, 0, 0, 1, 0, 1, -0, -1, 0, 0), C1 = CFN(0.5, 1, 0, 0, 0, 1, 0, 1, -0, -1, 0, 0), Parent = FakeTorso})
		CI("Motor6D", {Name = "Left Hip", Part0 = FakeTorso, Part1 = FakeLeftLeg, C0 = CFN(-1, -1, 0, 0, 0, -1, 0, 1, 0, 1, 0, 0), C1 = CFN(-0.5, 1, 0, 0, 0, -1, 0, 1, 0, 1, 0, 0), Parent = FakeTorso})
		CI("Animator", {Parent = FakeHum}); CI("HumanoidDescription", {Parent = FakeHum}); CI("SpecialMesh", {Scale = V3N(1,1,1)*1.25, Parent = FakeHead})
		CI("Script", {Name = "Health", Parent = FakeRig}); CI("LocalScript", {Name = "Animate", Parent = FakeRig})
		CI("Decal", {Name = "face", Texture = "rbxasset://textures/face.png", Transparency = 1, Parent = FakeHead})
		IN("Shirt", FakeRig) IN("Pants", FakeRig) IN("ShirtGraphic", FakeRig)
		CI("Attachment", {Name = "FaceCenterAttachment", Axis = V3N(1,0,0), SecondaryAxis = V3N(0,1,0), Parent = FakeHead})
		CI("Attachment", {Name = "FaceFrontAttachment", Position = V3N(0,0,-0.6), Axis = V3N(1,0,0), SecondaryAxis = V3N(0,1,0), Parent = FakeHead})
		CI("Attachment", {Name = "HairAttachment", Position = V3N(0,0.6,0), Axis = V3N(1,0,0), SecondaryAxis = V3N(0,1,0), Parent = FakeHead})
		CI("Attachment", {Name = "HatAttachment", Position = V3N(0,0.6,0), Axis = V3N(1,0,0), SecondaryAxis = V3N(0,1,0), Parent = FakeHead})
		CI("Attachment", {Name = "RootAttachment", Position = V3N(0,0.6,0), Axis = V3N(1,0,0), SecondaryAxis = V3N(0,1,0), Parent = FakeRoot})
		CI("Attachment", {Name = "RightGripAttachment", Position = V3N(0,-1,0), Axis = V3N(1,0,0), SecondaryAxis = V3N(0,1,0), Parent = FakeRightArm})
		CI("Attachment", {Name = "RightShoulderAttachment", Position = V3N(0,1,0), Axis = V3N(1,0,0), SecondaryAxis = V3N(0,1,0), Parent = FakeRightArm})
		CI("Attachment", {Name = "LeftGripAttachment", Position = V3N(0,-1,0), Axis = V3N(1,0,0), SecondaryAxis = V3N(0,1,0), Parent = FakeLeftArm})
		CI("Attachment", {Name = "LeftShoulderAttachment", Position = V3N(0,1,0), Axis = V3N(1,0,0), SecondaryAxis = V3N(0,1,0), Parent = FakeLeftArm})
		CI("Attachment", {Name = "RightFootAttachment", Position = V3N(0,-1,0), Axis = V3N(1,0,0), SecondaryAxis = V3N(0,1,0), Parent = FakeRightLeg})
		CI("Attachment", {Name = "LeftFootAttachment", Position = V3N(0,-1,0), Axis = V3N(1,0,0), SecondaryAxis = V3N(0,1,0), Parent = FakeLeftLeg})
		CI("Attachment", {Name = "BodyBackAttachment", Position = V3N(0,0,0.5), Axis = V3N(1,0,0), SecondaryAxis = V3N(0,1,0), Parent = FakeTorso})
		CI("Attachment", {Name = "BodyFrontAttachment", Position = V3N(0,0,-0.5), Axis = V3N(1,0,0), SecondaryAxis = V3N(0,1,0), Parent = FakeTorso})
		CI("Attachment", {Name = "LeftCollarAttachment", Position = V3N(-1, 1, 0), Axis = V3N(1,0,0), SecondaryAxis = V3N(0,1,0), Parent = FakeTorso})
		CI("Attachment", {Name = "NeckAttachment", Position = V3N(0, 1, 0), Axis = V3N(1,0,0), SecondaryAxis = V3N(0,1,0), Parent = FakeTorso})
		CI("Attachment", {Name = "RightCollarAttachment", Position = V3N(1, 1, 0), Axis = V3N(1,0,0), SecondaryAxis = V3N(0,1,0), Parent = FakeTorso})
		CI("Attachment", {Name = "WaistBackAttachment", Position = V3N(0, -1, 0.5), Axis = V3N(1,0,0), SecondaryAxis = V3N(0,1,0), Parent = FakeTorso})
		CI("Attachment", {Name = "WaistCenterAttachment", Position = V3N(0, -1, 0), Axis = V3N(1,0,0), SecondaryAxis = V3N(0,1,0), Parent = FakeTorso})
		CI("Attachment", {Name = "WaistFrontAttachment", Position = V3N(0, -1, -0.5), Axis = V3N(1,0,0), SecondaryAxis = V3N(0,1,0), Parent = FakeTorso})
		FakeRig.PrimaryPart = FakeHead; FakeRig.Name = LocalPlayer.Name
	end
end
if not KryptonData.R15Rig then
	KryptonData.R15Rig = IN("Model"); do
		local FakeRig = KryptonData.R15Rig
		local FakeHead = CI("Part", {Name = "Head", Size = V3N(2, 1, 1), Transparency = 1, CanCollide = false, Parent = FakeRig});
		local FakeUpperTorso = CI("MeshPart", {Name = "UpperTorso", Size = V3N(2, 1.6, 1), Transparency = 1, Parent = FakeRig})
		local FakeLowerTorso = CI("MeshPart", {Name = "LowerTorso", Size = V3N(2, 0.4, 1), Transparency = 1, CanCollide = false, Parent = FakeRig})
		local FakeRoot = CI("Part", {Name = "HumanoidRootPart", Size = V3N(2, 2, 1), Transparency = 1, Parent = FakeRig})
		CI("Motor6D", { Name = "Waist", Part0 = FakeLowerTorso, Part1 = FakeUpperTorso, C0 = CFN(-1.1920929e-07, 0.200024918, 7.64462551e-20, 1, 0, 0, 0, 1, 0, 0, 0, 1), C1 = CFN(-5.96046448e-08, -0.799985707, 1.1920929e-07, 1, 0, 0, 0, 1, 0, 0, 0, 1), Parent = FakeUpperTorso })
		CI("Motor6D", { Name = "Root", Part0 = FakeRoot, Part1 = FakeLowerTorso, C0 = CFN(0, -1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1), C1 = CFN(-1.1920929e-07, -0.199972257, -0, 1, 0, 0, 0, 1, 0, 0, 0, 1), Parent = FakeLowerTorso })
		CI("Motor6D", { Name = "Neck", Part0 = FakeUpperTorso, Part1 = FakeHead, C0 = CFN(-5.96046448e-08, 0.800017118, 1.1920929e-07, 1, 0, 0, 0, 1, 0, 0, 0, 1), C1 = CFN(0, -0.5, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1), Parent = FakeHead } )
	
		-- Right Arm
		local FakeRUA = CI("MeshPart", {Name = "RightUpperArm", Size = V3N(1, 1.169, 1), CanCollide = false, Transparency = 1, Parent = FakeRig})
		local FakeRLA = CI("MeshPart", {Name = "RightLowerArm", Size = V3N(1, 1.052, 1), CanCollide = false, Transparency = 1, Parent = FakeRig})
		local FakeRHand = CI("MeshPart", {Name = "RightHand", Size = V3N(1, 0.3, 1), CanCollide = false, Transparency = 1, Parent = FakeRig})
		CI("Motor6D", { Name = "RightShoulder", Part0 = FakeUpperTorso, Part1 = FakeRUA, C0 = CFN(0.99999994, 0.56301713, 1.1920929e-07, 1, 0, 0, 0, 1, 0, 0, 0, 1), C1 = CFN(-0.500000715, 0.394326687, 8.94069672e-08, 1, 0, 0, 0, 1, 0, 0, 0, 1), Parent = FakeRUA })
		CI("Motor6D", { Name = "RightElbow", Part0 = FakeRUA, Part1 = FakeRLA, C0 = CFN(-5.96046448e-07, -0.334165096, 8.94069672e-08, 1, 0, 0, 0, 1, 0, 0, 0, 1), C1 = CFN(1.1920929e-07, 0.258579493, 7.64462551e-20, 1, 0, 0, 0, 1, 0, 0, 0, 1), Parent = FakeRLA })
		CI("Motor6D", { Name = "RightWrist", Part0 = FakeRLA, Part1 = FakeRHand, C0 = CFN(1.1920929e-07, -0.5009287, -6.86244753e-18, 1, 0, 0, 0, 1, 0, 0, 0, 1), C1 = CFN(3.57627869e-07, 0.125045404, 5.96046448e-08, 1, 0, 0, 0, 1, 0, 0, 0, 1), Parent = FakeRHand })
	
		-- Left Arm
		local FakeLUA = CI("MeshPart", {Name = "LeftUpperArm", Size = V3N(1, 1.169, 1), CanCollide = false, Transparency = 1, Parent = FakeRig})
		local FakeLLA = CI("MeshPart", {Name = "LeftLowerArm", Size = V3N(1, 1.052, 1), CanCollide = false, Transparency = 1, Parent = FakeRig})
		local FakeLHand = CI("MeshPart", {Name = "LeftHand", Size = V3N(1, 0.3, 1), CanCollide = false, Transparency = 1, Parent = FakeRig})
		CI("Motor6D", { Name = "LeftShoulder", Part0 = FakeUpperTorso, Part1 = FakeLUA, C0 = CFN(-1, 0.56301713, 1.1920929e-07, 1, 0, 0, 0, 1, 0, 0, 0, 1), C1 = CFN(0.500000358, 0.394326687, 8.94069672e-08, 1, 0, 0, 0, 1, 0, 0, 0, 1), Parent = FakeLUA })
		CI("Motor6D", { Name = "LeftElbow", Part0 = FakeLUA, Part1 = FakeLLA, C0 = CFN(0.000479221344, -0.334056377, 8.94069672e-08, 1, 0, 0, 0, 1, 0, 0, 0, 1), C1 = CFN(0.000478625298, 0.258688211, 7.64462551e-20, 1, 0, 0, 0, 1, 0, 0, 0, 1), Parent = FakeLLA })
		CI("Motor6D", { Name = "LeftWrist", Part0 = FakeLLA, Part1 = FakeLHand, C0 = CFN(0.000478625298, -0.5009287, 7.64462551e-20, 1, 0, 0, 0, 1, 0, 0, 0, 1), C1 = CFN(0.000478982925, 0.125045404, 5.96046448e-08, 1, 0, 0, 0, 1, 0, 0, 0, 1), Parent = FakeLHand })
	
		-- Right Leg
		local FakeRUL = CI("MeshPart", {Name = "RightUpperLeg", Size = V3N(1, 1.217, 1), CanCollide = false, Transparency = 1, Parent = FakeRig})
		local FakeRLL = CI("MeshPart", {Name = "RightLowerLeg", Size = V3N(1, 1.052, 1), CanCollide = false, Transparency = 1, Parent = FakeRig})
		local FakeRFoot = CI("MeshPart", {Name = "RightFoot", Size = V3N(1, 0.3, 1), CanCollide = false, Transparency = 1, Parent = FakeRig})
		CI("Motor6D", { Name = "RightHip", Part0 = FakeLowerTorso, Part1 = FakeRUL, C0 = CFN(0.499999881, -0.199972257, -1.91208565e-05, 1, 0, 0, 0, 1, 0, 0, 0, 1), C1 = CFN(-0, 0.420782268, -6.67300628e-05, 1, 0, 0, 0, 1, 0, 0, 0, 1), Parent = FakeRUL })
		CI("Motor6D", { Name = "RightKnee", Part0 = FakeRUL, Part1 = FakeRLL, C0 = CFN(-0, -0.400946498, -2.18767891e-05, 1, 0, 0, 0, 1, 0, 0, 0, 1), C1 = CFN(-0, 0.379174292, 2.5553607e-05, 1, 0, 0, 0, 1, 0, 0, 0, 1), Parent = FakeRLL })
		CI("Motor6D", { Name = "RightAnkle", Part0 = FakeRLL, Part1 = FakeRFoot, C0 = CFN(-0, -0.547157168, 7.62689815e-05, 1, 0, 0, 0, 1, 0, 0, 0, 1), C1 = CFN(-0, 0.101939559, 7.64477954e-05, 1, 0, 0, 0, 1, 0, 0, 0, 1), Parent = FakeRFoot })
	
		-- Left Leg
		local FakeLUL = CI("MeshPart", {Name = "LeftUpperLeg", Size = V3N(1, 1.217, 1), CanCollide = false, Transparency = 1, Parent = FakeRig})
		local FakeLLL = CI("MeshPart", {Name = "LeftLowerLeg", Size = V3N(1, 1.052, 1), CanCollide = false, Transparency = 1, Parent = FakeRig})
		local FakeLFoot = CI("MeshPart", {Name = "LeftFoot", Size = V3N(1, 0.3, 1), CanCollide = false, Transparency = 1, Parent = FakeRig})
		CI("Motor6D", { Name = "LeftHip", Part0 = FakeLowerTorso, Part1 = FakeLUL, C0 = CFN(-0.500000119, -0.199972257, -0, 1, 0, 0, 0, 1, 0, 0, 0, 1), C1 = CFN(5.96046448e-08, 0.420782208, -1.63912773e-07, 1, 0, 0, 0, 1, 0, 0, 0, 1), Parent = FakeLUL })
		CI("Motor6D", { Name = "LeftKnee", Part0 = FakeLUL, Part1 = FakeLLL, C0 = CFN(8.94069672e-08, -0.401102424, -4.29081496e-07, 1, 0, 0, 0, 1, 0, 0, 0, 1), C1 = CFN(2.98023224e-08, 0.379018486, -1.60860594e-07, 1, 0, 0, 0, 1, 0, 0, 0, 1), Parent = FakeLLL })
		CI("Motor6D", { Name = "LeftAnkle", Part0 = FakeLLL, Part1 = FakeLFoot, C0 = CFN(-1.1920929e-07, -0.547157228, -2.21401592e-06, 1, 0, 0, 0, 1, 0, 0, 0, 1), C1 = CFN(-1.78813934e-07, 0.101939693, -1.7222776e-06, 1, 0, 0, 0, 1, 0, 0, 0, 1), Parent = FakeLFoot })
		
		-- Misc
		local FakeHum = CI("Humanoid", {DisplayDistanceType = Enum.HumanoidDisplayDistanceType.None, RigType = Enum.HumanoidRigType.R15, Parent = FakeRig})
		CI("Animator", {Parent = FakeHum}); CI("HumanoidDescription", {Parent = FakeHum});
		CI("Script", {Name = "Health", Parent = FakeRig}); CI("LocalScript", {Name = "Animate", Parent = FakeRig})
		CI("Decal", {Name = "face", Texture = "rbxasset://textures/face.png", Transparency = 1, Parent = FakeHead})
		IN("Shirt", FakeRig) IN("Pants", FakeRig) IN("ShirtGraphic", FakeRig)
		
		-- Values and Attachments
		CI("NumberValue",{ Name = "BodyDepthScale", Value = 1, Parent = FakeHum})
		CI("NumberValue",{ Name = "BodyHeightScale", Value = 1, Parent = FakeHum})
		CI("NumberValue",{ Name = "BodyProportionScale", Value = 0, Parent = FakeHum})
		CI("NumberValue",{ Name = "BodyTypeScale", Value = 0, Parent = FakeHum})
		CI("NumberValue",{ Name = "BodyWidthScale", Value = 1, Parent = FakeHum})
		CI("NumberValue",{ Name = "HeadScale", Value = 1, Parent = FakeHum})
		CI("Attachment", { Name = "RootRigAttachment", Position = V3N(0, -1, 0), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeRoot })
		CI("Attachment", { Name = "LeftWristRigAttachment", Position = V3N(0.00047898292541503906, 0.12504540383815765, 5.960464477539063e-08), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeLHand })
		CI("Attachment", { Name = "LeftGripAttachment", Position = V3N(0, -0.14995451271533966, -1.4630612099608697e-07), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 6.123234262925839e-17, -1), Parent = FakeLHand })
		CI("Attachment", { Name = "LeftElbowRigAttachment", Position = V3N(0.0004786252975463867, 0.25868821144104004, 7.644625506630354e-20), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeLLA })
		CI("Attachment", { Name = "LeftWristRigAttachment", Position = V3N(0.0004786252975463867, -0.5009286999702454, 7.644625506630354e-20), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeLLA })
		CI("Attachment", { Name = "LeftShoulderRigAttachment", Position = V3N(0.5000003576278687, 0.39432668685913086, 8.940696716308594e-08), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeLUA })
		CI("Attachment", { Name = "LeftElbowRigAttachment", Position = V3N(0.0004792213439941406, -0.33405637741088867, 8.940696716308594e-08), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeLUA })
		CI("Attachment", { Name = "LeftShoulderAttachment", Position = V3N(2.384185791015625e-07, 0.5843266248703003, -2.7096831445305725e-08), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeLUA })
		CI("Attachment", { Name = "RightWristRigAttachment", Position = V3N(3.5762786865234375e-07, 0.12504540383815765, 5.960464477539063e-08), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeRHand })
		CI("Attachment", { Name = "RightGripAttachment", Position = V3N(0, -0.14995451271533966, -1.4630612099608697e-07), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 6.123234262925839e-17, -1), Parent = FakeRHand })
		CI("Attachment", { Name = "RightElbowRigAttachment", Position = V3N(1.1920928955078125e-07, 0.2585794925689697, 7.644625506630354e-20), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeRLA })
		CI("Attachment", { Name = "RightWristRigAttachment", Position = V3N(1.1920928955078125e-07, -0.5009286999702454, -6.862447526056303e-18), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeRLA })
		CI("Attachment", { Name = "RightShoulderRigAttachment", Position = V3N(-0.5000007152557373, 0.39432668685913086, 8.940696716308594e-08), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeRUA })
		CI("Attachment", { Name = "RightElbowRigAttachment", Position = V3N(-5.960464477539062e-07, -0.334165096282959, 8.940696716308594e-08), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeRUA })
		CI("Attachment", { Name = "RightShoulderAttachment", Position = V3N(-8.344650268554688e-07, 0.5843266248703003, -2.7096831445305725e-08), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeRUA })
		CI("Attachment", { Name = "WaistRigAttachment", Position = V3N(-5.960464477539063e-08, -0.7999857068061829, 1.1920928955078125e-07), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeUpperTorso })
		CI("Attachment", { Name = "NeckRigAttachment", Position = V3N(-5.960464477539063e-08, 0.8000171184539795, 1.1920928955078125e-07), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeUpperTorso })
		CI("Attachment", { Name = "LeftShoulderRigAttachment", Position = V3N(-1, 0.5630171298980713, 1.1920928955078125e-07), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeUpperTorso })
		CI("Attachment", { Name = "RightShoulderRigAttachment", Position = V3N(0.9999999403953552, 0.5630171298980713, 1.1920928955078125e-07), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeUpperTorso })
		CI("Attachment", { Name = "BodyFrontAttachment", Position = V3N(-5.960464477539063e-08, -0.19998568296432495, -0.49999988079071045), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeUpperTorso })
		CI("Attachment", { Name = "BodyBackAttachment", Position = V3N(-5.960464477539063e-08, -0.19998568296432495, 0.5), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeUpperTorso })
		CI("Attachment", { Name = "LeftCollarAttachment", Position = V3N(-0.9999998807907104, 0.8000169992446899, -7.273973778865184e-08), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeUpperTorso })
		CI("Attachment", { Name = "RightCollarAttachment", Position = V3N(0.9999999403953552, 0.8000167608261108, 4.612959969563235e-08), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeUpperTorso })
		CI("Attachment", { Name = "NeckAttachment", Position = V3N(-5.058594965134944e-08, 0.8000171184539795, 7.111724187325308e-08), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeUpperTorso })
		CI("Attachment", { Name = "LeftAnkleRigAttachment", Position = V3N(-1.7881393432617188e-07, 0.10193969309329987, -0.0000017222776023118058), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeLFoot })
		CI("Attachment", { Name = "LeftKneeRigAttachment", Position = V3N(2.9802322387695312e-08, 0.37901848554611206, -1.6086059417830256e-07), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeLLL })
		CI("Attachment", { Name = "LeftAnkleRigAttachment", Position = V3N(-1.1920928955078125e-07, -0.5471572279930115, -0.0000022140159217087785), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeLLL })
		CI("Attachment", { Name = "LeftHipRigAttachment", Position = V3N(5.960464477539063e-08, 0.420782208442688, -1.6391277313232422e-07), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeLUL })
		CI("Attachment", { Name = "LeftKneeRigAttachment", Position = V3N(8.940696716308594e-08, -0.4011024236679077, -4.290814956675604e-07), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeLUL })
		CI("Attachment", { Name = "RightAnkleRigAttachment", Position = V3N(-0, 0.10193955898284912, 0.00007644779543625191), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeRFoot })
		CI("Attachment", { Name = "RightKneeRigAttachment", Position = V3N(-0, 0.37917429208755493, 0.000025553606974426657), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeRLL })
		CI("Attachment", { Name = "RightAnkleRigAttachment", Position = V3N(-0, -0.5471571683883667, 0.00007626898150192574), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeRLL })
		CI("Attachment", { Name = "RightHipRigAttachment", Position = V3N(-0, 0.42078226804733276, -0.0000667300628265366), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeRUL })
		CI("Attachment", { Name = "RightKneeRigAttachment", Position = V3N(-0, -0.4009464979171753, -0.000021876789105590433), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeRUL })
		CI("Attachment", { Name = "RootRigAttachment", Position = V3N(-1.1920928955078125e-07, -0.1999722570180893, -0), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeLowerTorso })
		CI("Attachment", { Name = "WaistRigAttachment", Position = V3N(-1.1920928955078125e-07, 0.20002491772174835, 7.644625506630354e-20), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeLowerTorso })
		CI("Attachment", { Name = "LeftHipRigAttachment", Position = V3N(-0.5000001192092896, -0.1999722570180893, -0), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeLowerTorso })
		CI("Attachment", { Name = "RightHipRigAttachment", Position = V3N(0.49999988079071045, -0.1999722570180893, -0.00001912085645017214), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeLowerTorso })
		CI("Attachment", { Name = "WaistCenterAttachment", Position = V3N(-4.220008804622921e-07, -0.1999722570180893, -1.6543612251060553e-24), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeLowerTorso })
		CI("Attachment", { Name = "WaistFrontAttachment", Position = V3N(-1.3221986705502786e-07, -0.1999722570180893, -0.5000000596046448), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeLowerTorso })
		CI("Attachment", { Name = "WaistBackAttachment", Position = V3N(-1.4641321399722074e-07, -0.1999722570180893, 0.5000000596046448), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeLowerTorso })
		CI("Attachment", { Name = "FaceCenterAttachment", Position = V3N(0, 0, 0), Axis = V3N(1, -7.871375551360416e-09, -3.029981271446139e-15), SecondaryAxis = V3N(7.871375551360416e-09, 1, 4.1444255377034967e-16), Parent = FakeHead })
		CI("Attachment", { Name = "FaceFrontAttachment", Position = V3N(0, 0, -0.6000000238418579), Axis = V3N(1, -7.871375551360416e-09, -3.029981271446139e-15), SecondaryAxis = V3N(7.871375551360416e-09, 1, 4.1444255377034967e-16), Parent = FakeHead })
		CI("Attachment", { Name = "HairAttachment", Position = V3N(0, 0.6000000238418579, 0), Axis = V3N(1, -7.871375551360416e-09, -3.029981271446139e-15), SecondaryAxis = V3N(7.871375551360416e-09, 1, 4.1444255377034967e-16), Parent = FakeHead })
		CI("Attachment", { Name = "HatAttachment", Position = V3N(0, 0.6000000238418579, 0), Axis = V3N(1, -7.871375551360416e-09, -3.029981271446139e-15), SecondaryAxis = V3N(7.871375551360416e-09, 1, 4.1444255377034967e-16), Parent = FakeHead })
		CI("Attachment", { Name = "NeckRigAttachment", Position = V3N(0, -0.5, 0), Axis = V3N(1, 0, 0), SecondaryAxis = V3N(0, 1, 0), Parent = FakeHead })	
		FakeRig.PrimaryPart = FakeRoot; FakeRig.Name = LocalPlayer.Name;
	end	
end; 

local FakeRig = KryptonData[ReanimSettings.R15Reanimation and "R15Rig" or "R6Rig"]:Clone()
local FakeRoot = FakeRig.HumanoidRootPart
local FakeHum = FakeRig.Humanoid
local FakeHead = FakeRig.Head
local FakeRigDescendants = FakeRig:GetDescendants()
FakeRig.Parent = Workspace
FakeRig:MoveTo(RealRig.PrimaryPart.Position + V3N(0, 5, 0))

local ReWeldHats, GetHandle, CFrameTo, ClearUpData; do -- [[ Functions ]] --
	ReWeldHats = function(Handle)
		local FakeAccessory = Handle.Parent:Clone()
		local Handle = FakeAccessory:FindFirstChild("Handle")
		local Attachment = Handle:FindFirstChildOfClass("Attachment")
		local OldWeld = Handle:FindFirstChild("AccessoryWeld") or Handle:FindFirstChildOfClass("Weld")
		local OldWeldData = {OldWeld.C0, OldWeld.C1, OldWeld.Part1}
		local Weld = CI("Weld", {Name = "AccessoryWeld", Part0 = Handle, Parent = Handle})
		OldWeld:Destroy(); Handle.Transparency = 1

		if (not OldWeldData[3]) or (OldWeldData[3] and OldWeldData[3].Name ~= "Head") then 
			if Attachment then
				Weld.C0 = Attachment.CFrame
				Weld.C1 = FakeRig:FindFirstChild(tostring(Attachment), true).CFrame
				Weld.Part1 = FakeRig:FindFirstChild(tostring(Attachment), true).Parent
			else
				Weld.Part1 = FakeHead
				Weld.C1 = CFN(0, FakeHead.Size.Y / 2, 0) * FakeAccessory.AttachmentPoint:Inverse()
			end
		elseif OldWeldData[3] and OldWeldData[3].Name == "Head" then
			Weld.C0 = OldWeldData[1]
			Weld.C1 = OldWeldData[2]
			Weld.Part1 = FakeHead
		end

		FakeAccessory.Parent = FakeRig; return FakeAccessory
	end

	GetHandle = function(AccessoryID, Check)
		for _, Handle in pairs(Handles) do
			local Mesh = Handle:FindFirstChildOfClass("SpecialMesh") or Handle
			local PropertyName = Check and "MeshId" or pcall(function() Mesh["TextureID"] = Mesh["TextureID"] end) and "TextureID" or "TextureId"
			if (Mesh[PropertyName] == AccessoryID) or (Mesh[PropertyName] == "rbxassetid://"..AccessoryID) then
				TRemove(Handles, TFind(Handles, Handle))
				FakeRig:FindFirstChild(Handle.Parent.Name):Destroy()
				return Handle
			end
		end
	end

	local VelMultiply = ReanimSettings.VelocityMultiply
	local Clamp = math.clamp
	CFrameTo = function(Part0, Part1, Offset)
		if Part0 and Part1 and IsPartOwned(Part0) then
			Part0.AssemblyLinearVelocity = V3N(
				Part1.AssemblyLinearVelocity.X * (Part0.Mass * VelMultiply), 
				25.06 + Random(20,60)/Random(8,15), 
				Part1.AssemblyLinearVelocity.Z * (Part0.Mass * VelMultiply)
			)

			Part0.AssemblyAngularVelocity = RotVelocityOffset
			Part0.CFrame = Part1.CFrame * Offset * AntiSleepOffset
		end
	end

	ClearUpData = function()
		local Data = Global.KryptonData

		for _, Signal in pairs(Events) do
			Signal:Disconnect()
		end

		for _, GlobalSignal in pairs(Data['Global Events']) do
			GlobalSignal:Disconnect()
		end

		Data['Script Stopped'] = true
		Data['Script Running'] = false
		Data['Hat Folder']:ClearAllChildren()
		Data["Fling Part"] = nil

		Global.KryptonReanimateLoaded = nil
		IsAlive = false

		Delay(0.25, function()
			Data['Script Stopped'] = false
		end)
	end
end

do -- [[ Respawn Events ]] --
	local Parent = RealRig.Parent; TInsert(Events, RealRig:GetPropertyChangedSignal("Parent"):Connect(function()
		Parent = RealRig.Parent
		if Parent == nil then
			ClearUpData()
			FakeRig:Destroy()
		end
	end))

	DiedEvent = FakeHum.Died:Connect(function()
		ClearUpData()
		LocalPlayer.Character = RealRig
		RealRig.Parent = Workspace
		FakeRig:Destroy()
	end)

	FakeRoot.Anchored = false
	FakeHum:ChangeState(2)
	FakeHum:ChangeState(7)
	RealRig.Parent = FakeRig
end

for _, Part in pairs(RealRigDescendants) do
	if Part:IsA("BasePart") then
		Part.Anchored = false
		Part.Massless = false 
		PreSimulation:Wait()	

	elseif Part:IsA("Accessory") then
		local Handle = Part:FindFirstChild("Handle") or Part:FindFirstChildOfClass("BasePart")
		Handle.Transparency = 0
		local NewHat = ReWeldHats(Handle)
		local CachedHat = NewHat:Clone()

		CachedHat.Parent = Global.KryptonData["Hat Folder"]
		TInsert(Handles, Handle)
	elseif Part:IsA("LocalScript") then
		Part.Disabled = true
	end
end

local FlingPart; if ReanimSettings.FlingEnabled then 
	if RealRig:FindFirstChildOfClass("Tool") then -- Check if player has any tool.
		local Tool = RealRig:FindFirstChildOfClass("Tool")
		local Backpack = LocalPlayer:FindFirstChildOfClass("Backpack")
		if Tool then
			FlingPart = Tool:WaitForChild("Handle", 20)
			local BreathEffect = ReanimSettings.BulletEffects
			local Highlight, Event, A = IN("SelectionBox"), nil, nil
			Highlight.Adornee = FlingPart
			Highlight.Parent = FlingPart
			Highlight.LineThickness = 0.075
			Global.KryptonData["Fling Part"] = FlingPart

			Event = PreSimulation:Connect(function()
				if not FlingPart and FlingPart.Parent then
					Event:Disconnect()
				end

				FlingPart.CanCollide = false
				FlingPart.CanQuery = false
				FlingPart.CanTouch = false

				if BreathEffect then
					A = Sin(Clock())
					Highlight.Color3 = Color3.fromHSV(124, 83, A)
				end
			end)

			Delay(0.1, function()
				FlingPart.Massless = true
			end)
		end
	end 
end

LocalPlayer.Character = FakeRig
Global.KryptonReanimateLoaded = true

do -- [[ Perma Death ]] --
	local Backpack = LocalPlayer:FindFirstChildOfClass("Backpack")
	if Backpack then Backpack:ClearAllChildren() end
	Camera.CameraSubject = CI("Part", {Position = V3N(0, 5000, 12000), Anchored = true, Transparency = 1, Parent = RealRoot})
	local TempEvent; TempEvent = PreSimulation:Connect(function()
		for _,v in pairs(RealRigDescendants) do
			if v and v.Parent and v:IsA("BasePart") then
				v.CanCollide = false
			end
		end
	end)

	local Offset = RealRoot.CFrame * CFN(RealRoot.CFrame.LookVector.X * (1125*#Players:GetPlayers()), Workspace.FallenPartsDestroyHeight+500, 0)
	if ReanimSettings.RemoveBodyParts then 
		Defer(function()
			local Event; Event = PostSimulation:Connect(function()
				RealRoot.CFrame = Offset
			end)

			local LoadPoint = FakeRoot.CFrame * CFN(0,4,0)
			FakeRoot.CFrame = RealRoot.CFrame * CFN(0, -350, 0); PostSimulation:Wait();
			FakeRoot.Anchored = true; Wait(WaitTime)
			RealRoot.Velocity = V3N(0, -125, 0); PostSimulation:Wait()
			RealRig:BreakJoints()
			Event:Disconnect()

			for _,v in pairs(Handles) do v.Velocity = V3N(25.05,25.05,25.05) end
			if FlingPart then FlingPart.Velocity = V3N(25.05,25.05,25.05) end
			if ReanimSettings.FastLoad then
				Wait(0.375)
			else
				for _=0,100 do
					if not RealRig:FindFirstChild(RealRoot.Name) then
						break
					end; Wait(0.005)
				end
				if FlingPart then
					FakeRoot.Anchored = false
					FakeRoot.CFrame = FlingPart.CFrame
					FakeRoot.Anchored = true
					Wait(0.5)
				end
				Wait(0.25)
			end
			TempEvent:Disconnect()
			FakeRoot.Anchored = false
			FakeRoot.CFrame = LoadPoint
			FakeHum:ChangeState(2)
			FakeHum:ChangeState(7)
			Camera.CameraSubject = FakeHum
		end)
	else
		Wait(WaitTime)
		RealRoot.Velocity = RealRoot.CFrame.LookVector*35
		RealRig:BreakJoints()
		TempEvent:Disconnect()
		Camera.CameraSubject = FakeHum
	end
end

local FakeHandles = {}
local FakeTorso,FakeRightArm,FakeLeftArm,FakeRightLeg,FakeLeftLeg
Defer(function() -- align part + Movement
	local NoCollisions = ReanimSettings.NoClip
	local DesiredHats = ReanimSettings.DefinedHats
	local AntiSleepEnabled = ReanimSettings.AntiSleep
	local AntiVoidEnabled = ReanimSettings.AntiVoid
	local AntiVoidOffset = ReanimSettings.AntiVoidOffset
	local ExploitCheck = not ReanimSettings.LocalScriptSupport

	if ExploitCheck and ReanimSettings.PhysicsTweaks then
		local Physics = settings().Physics
		
		SetHiddenProp(Humanoid, "InternalBodyScale", V3N(9e9,9e9,9e9))
		SetHiddenProp(Workspace, "PhysicsSteppingMethod", Enum.PhysicsSteppingMethod.Fixed)
		SetHiddenProp(Workspace, "SignalBehavior", "Immediate")
		Workspace.InterpolationThrottling = Enum.InterpolationThrottlingMode.Disabled
		Physics.PhysicsEnvironmentalThrottle = Enum.EnviromentalPhysicsThrottle.Disabled
		Physics.AllowSleep = false
		Physics.ForceCSGv2 = false
		Physics.DisableCSGv2 = false
		Physics.UseCSGv2 = false
		Physics.ThrottleAdjustTime = 1/0
		Workspace.Retargeting = "Disabled"

		for _,v in pairs(FakeRigDescendants) do
			if v:IsA("BasePart") then
				v.CastShadow = false
			end
		end

		for _,v in pairs(RealRigDescendants) do
			if v:IsA("BasePart") then
				v.CastShadow = false
			end
		end
	end

	local FPDH = Workspace.FallenPartsDestroyHeight
	local SpawnPoint = Workspace:FindFirstChildOfClass("SpawnLocation") and Workspace:FindFirstChildOfClass("SpawnLocation").CFrame * CFN(0,20,0) or CFN(0,20,0)
	local T1 = GetHandle(DesiredHats[1][1], DesiredHats[1][4]); local T1_CF = DesiredHats[1][2] * DesiredHats[1][3]
	local T2 = GetHandle(DesiredHats[2][1], DesiredHats[2][4]); local T2_CF = DesiredHats[2][2] * DesiredHats[2][3]
	local RA = GetHandle(DesiredHats[3][1], DesiredHats[3][4]); local RA_CF = DesiredHats[3][2] * DesiredHats[3][3]
	local LA = GetHandle(DesiredHats[4][1], DesiredHats[4][4]); local LA_CF = DesiredHats[4][2] * DesiredHats[4][3]
	local RL = GetHandle(DesiredHats[5][1], DesiredHats[5][4]); local RL_CF = DesiredHats[5][2] * DesiredHats[5][3]
	local LL = GetHandle(DesiredHats[6][1], DesiredHats[6][4]); local LL_CF = DesiredHats[6][2] * DesiredHats[6][3]

	for i = 1,#Handles do -- myworld optimization (he told me to do this) (fake)
		local Handle = Handles[i]
		if Handle then
			local FakeHandle = FakeRig:FindFirstChild(Handle.Parent.Name) and FakeRig[Handle.Parent.Name]:FindFirstChild("Handle")
			if FakeHandle then
				TInsert(FakeHandles, FakeHandle)
			end
		end
	end

	FakeTorso = FakeRig:FindFirstChild("Torso") or FakeRig:FindFirstChild("UpperTorso")
	FakeRightArm = FakeRig:FindFirstChild("Right Arm") or FakeRig:FindFirstChild("RightLowerArm")
	FakeLeftArm = FakeRig:FindFirstChild("Left Arm") or FakeRig:FindFirstChild("LeftLowerArm")
	FakeRightLeg = FakeRig:FindFirstChild("Right Leg") or FakeRig:FindFirstChild("RightLowerLeg")
	FakeLeftLeg = FakeRig:FindFirstChild("Left Leg") or FakeRig:FindFirstChild("LeftLowerLeg")
	TInsert(Events, PostSimulation:Connect(function()
		FakeHum:Move(FakeHum.MoveDirection, false)
		CFrameTo(T1, FakeTorso, T1_CF)
		CFrameTo(T2, FakeTorso, T2_CF)
		CFrameTo(RA, FakeRightArm, RA_CF)
		CFrameTo(LA, FakeLeftArm, LA_CF)
		CFrameTo(RL, FakeRightLeg, RL_CF)
		CFrameTo(LL, FakeLeftLeg, LL_CF)
		for i = 1,#Handles do 
			local Handle, FakeHandle = Handles[i], FakeHandles[i]			
			if Handle and FakeHandle then
				CFrameTo(Handle, FakeHandle, CF0)
			end
		end

		if FlingPart and FakeRoot and IsPartOwned(FlingPart) then
			FlingPart.AssemblyLinearVelocity = V3N(FakeRoot.AssemblyLinearVelocity.X * 7, -30, FakeRoot.AssemblyLinearVelocity.Z * 7)
			if Global.FlingOnHold then
				FlingPart.CFrame = FakeRoot.CFrame * AntiSleepOffset
				FlingPart.AssemblyAngularVelocity = RotVelocityOffset
			end
		end
	end))

	TInsert(Events, PreSimulation:Connect(function()
		if NoCollisions then
			for _,v in pairs(FakeRigDescendants) do
				if v and v.Parent and v:IsA("BasePart") then
					v.CanCollide = false
					v.CanQuery = false
					v.CanTouch = false
				end
			end
		end

		if AntiVoidEnabled and FakeRoot and FakeRoot.Position.Y <= (FPDH+AntiVoidOffset) then
			FakeRoot.CFrame = SpawnPoint
			FakeRoot.Velocity = V30
		end

		if AntiSleepEnabled then AntiSleepOffset = CFN(0.0065 * Sin(Clock()*32), 0, 0.0065 * Cos(Clock()*32))  end
		RotVelocityOffset = V3N(0, Sin(Clock())*5, 0)
		CalculatedY = 26 + 1 + Clock()

		if ExploitCheck then
			SetHiddenProp(LocalPlayer, "MaximumSimulationRadius", 9999)
			SetHiddenProp(LocalPlayer, "SimulationRadius", LocalPlayer.MaximumSimulationRadius)
		end
	end))
end)

Spawn(function() -- misc settings
	local EnableFunnySounds = ReanimSettings.thesounds
	local ApplyFunnySounds = function()
		for _,v in pairs(FakeRoot:GetChildren()) do
			if v:IsA("Sound") then
				CI("DistortionSoundEffect", {Level = 1, Parent = v}); v.Volume = 5
			end
		end
	end
	
	if ReanimSettings["Workspace.AntiSleep"] then
		TInsert(Events, PostSimulation:Connect(function()
			if (FakeRoot and FakeHum) and FakeHum.MoveDirection.Magnitude < 0.1 then 
				FakeRoot.CFrame = FakeRoot.CFrame * CFN(1 * Cos(tick()*32), 0, 0)
			end
		end))
	end

	if ReanimSettings.LeaningAnims then -- (emped helped with this a lot)
		local RootJoint = FakeRoot:FindFirstChild("RootJoint") or FakeRig.LowerTorso:FindFirstChild("Root")
		local RootJointC0 = RootJoint.C0
		TInsert(Events, PostSimulation:Connect(function(Delta)
			local RightVector = FakeRoot.CFrame.RightVector * FakeRoot.AssemblyLinearVelocity				
			local Sideways = Rad(RightVector.X + RightVector.Z)

			if FakeRoot and RootJoint then
				RootJoint.C0 = RootJoint.C0:Lerp(CFA(0, - Sideways, - Sideways) * RootJointC0, Delta * 10)
			end
		end))
	end

	if FlingPart and ReanimSettings.FlingEnabled and ReanimSettings.MouseFlingOnceReanimated then
		local GEvents = Global.KryptonData['Global Events']
		local StaticValue = V3N(0, 7500, 0)
		local Mouse = LocalPlayer:GetMouse()
		local CurrentTarget;
		local TargetHumanoid;

		TInsert(GEvents, Mouse.Button1Down:Connect(function()
			Global.FlingOnHold = false
		end))

		TInsert(GEvents, Mouse.Button1Up:Connect(function()
			Global.FlingOnHold = true
		end))

		TInsert(GEvents, PostSimulation:Connect(function()
			if Global.FlingOnHold == false and FlingPart and IsPartOwned(FlingPart) then
				if Mouse.Target ~= nil then
					CurrentTarget = Mouse.Target.Parent and Mouse.Target.Parent:FindFirstChildOfClass("Part") or Mouse.Target.Parent.Parent and Mouse.Target.Parent.Parent:FindFirstChildOfClass("Part")
					FlingPart.AssemblyAngularVelocity = StaticValue
					if CurrentTarget and CurrentTarget.Name == "HumanoidRootPart" or CurrentTarget.Name == "Head" or CurrentTarget.Name == "Handle" then
						TargetHumanoid = CurrentTarget.Parent:FindFirstChildOfClass("Humanoid") or CurrentTarget.Parent.Parent:FindFirstChildOfClass("Humanoid") 
						if TargetHumanoid and TargetHumanoid.MoveDirection.Magnitude >= 0.1 then
							FlingPart.CFrame = CFN(CurrentTarget.Position) * CFN(TargetHumanoid.MoveDirection*7.5)
						else
							FlingPart.CFrame = CFN(CurrentTarget.Position) * (CurrentTarget.Velocity.Magnitude > 6 and CFN(CurrentTarget.CFrame.LookVector*Random(-4, 5)) or CF0)
						end
					else
						FlingPart.CFrame = Mouse.Hit
					end
				else
					FlingPart.CFrame = FakeRoot.CFrame * AntiSleepOffset
					FlingPart.AssemblyAngularVelocity = RotVelocityOffset
				end
			end
		end))
	end
	
	if EnableFunnySounds then
		ApplyFunnySounds()
	end
end)
-- anims and gui
if ReanimSettings.Animations and (not ReanimSettings.R15Reanimation) then
	Spawn(function()local a=FakeRig["Animate"]local b=a and a.Parent and a.Enabled or false;local c=FakeTorso:FindFirstChild("Right Shoulder")local d=FakeTorso:FindFirstChild("Left Shoulder")local e=FakeTorso:FindFirstChild("Right Hip")local f=FakeTorso:FindFirstChild("Left Hip")local g=FakeTorso:FindFirstChild("Neck")local h=FakeHum:FindFirstChildOfClass("Animator")local i="Standing"local j=""local k=nil;local l=nil;local m=nil;local n=1.0;local o=""local p=nil;local q=nil;local r=nil;local s=0;local t="None"local u=0;local v=0;local w=0.3;local x=0.1;local y=0.3;local z=0.75;local A=0;local B={}local C={"dance1","dance2","dance3"}local D={wave=false,point=false,dance1=true,dance2=true,dance3=true,laugh=false,cheer=false}local E={idle={{id="http://www.roblox.com/asset/?id=180435571",weight=9},{id="http://www.roblox.com/asset/?id=180435792",weight=1}},walk={{id="http://www.roblox.com/asset/?id=180426354",weight=10}},run={{id="run.xml",weight=10}},jump={{id="http://www.roblox.com/asset/?id=125750702",weight=10}},fall={{id="http://www.roblox.com/asset/?id=180436148",weight=10}},climb={{id="http://www.roblox.com/asset/?id=180436334",weight=10}},sit={{id="http://www.roblox.com/asset/?id=178130996",weight=10}},toolnone={{id="http://www.roblox.com/asset/?id=182393478",weight=10}},toolslash={{id="http://www.roblox.com/asset/?id=129967390",weight=10}},toollunge={{id="http://www.roblox.com/asset/?id=129967478",weight=10}},wave={{id="http://www.roblox.com/asset/?id=128777973",weight=10}},point={{id="http://www.roblox.com/asset/?id=128853357",weight=10}},dance1={{id="http://www.roblox.com/asset/?id=182435998",weight=10},{id="http://www.roblox.com/asset/?id=182491037",weight=10},{id="http://www.roblox.com/asset/?id=182491065",weight=10}},dance2={{id="http://www.roblox.com/asset/?id=182436842",weight=10},{id="http://www.roblox.com/asset/?id=182491248",weight=10},{id="http://www.roblox.com/asset/?id=182491277",weight=10}},dance3={{id="http://www.roblox.com/asset/?id=182436935",weight=10},{id="http://www.roblox.com/asset/?id=182491368",weight=10},{id="http://www.roblox.com/asset/?id=182491423",weight=10}},laugh={{id="http://www.roblox.com/asset/?id=129423131",weight=10}},cheer={{id="http://www.roblox.com/asset/?id=129423030",weight=10}}}local function F(G,H)if B[G]~=nil then for I,J in pairs(B[G].connections)do J:disconnect()end end;B[G]={}B[G].count=0;B[G].totalWeight=0;B[G].connections={}local K=script:FindFirstChild(G)if K~=nil then TInsert(B[G].connections,K.ChildAdded:connect(function(L)F(G,H)end))TInsert(B[G].connections,K.ChildRemoved:connect(function(L)F(G,H)end))local M=1;for I,N in pairs(K:GetChildren())do if N:IsA("Animation")then TInsert(B[G].connections,N.Changed:connect(function(O)F(G,H)end))B[G][M]={}B[G][M].anim=N;local P=N:FindFirstChild("Weight")if P==nil then B[G][M].weight=1 else B[G][M].weight=P.Value end;B[G].count=B[G].count+1;B[G].totalWeight=B[G].totalWeight+B[G][M].weight;M=M+1 end end end;if B[G].count<=0 then for M,Q in pairs(H)do B[G][M]={}B[G][M].anim=IN("Animation")B[G][M].anim.Name=G;B[G][M].anim.AnimationId=Q.id;B[G][M].weight=Q.weight;B[G].count=B[G].count+1;B[G].totalWeight=B[G].totalWeight+Q.weight end end end;if h then local R=h:GetPlayingAnimationTracks()for S,T in ipairs(R)do T:Stop(0)T:Destroy()end end;for G,H in pairs(E)do F(G,H)end;local function U()local V=j;if D[V]~=nil and D[V]==false then V="idle"end;j,k="",nil;if m~=nil then m:disconnect()end;if l~=nil then l:Stop()l:Destroy()l=nil end;return V end;local function W(X)if X~=n then n=X;l:AdjustSpeed(n)end end;local Y=function()end;local Z=function()end;local function _(a0)if a0=="End"then local a1=j;if D[a1]~=nil and D[a1]==false then a1="idle"end;local a2=n;Y(a1,0.0,FakeHum)W(a2)end end;Y=function(a3,a4,a5)local a6=Random(1,B[a3].totalWeight)local a7=a6;local M=1;while a6>B[a3][M].weight do a6=a6-B[a3][M].weight;M=M+1 end;local Q=B[a3][M].anim;if Q~=k then if l~=nil then l:Stop(a4)l:Destroy()end;n=1.0;l=a5:LoadAnimation(Q)l.Priority=Enum.AnimationPriority.Core;l:Play(a4)j=a3;k=Q;if m~=nil then m:disconnect()end;m=l.KeyframeReached:connect(_)end end;local function a8(a3,a4,a5,a9)local a6=Random(1,B[a3].totalWeight)local a7=a6;local M=1;while a6>B[a3][M].weight do a6=a6-B[a3][M].weight;M=M+1 end;local Q=B[a3][M].anim;if q~=Q then if p~=nil then p:Stop()p:Destroy()a4=0 end;p=a5:LoadAnimation(Q)if a9 then p.Priority=a9 end;p:Play(a4)o=a3;q=Q;r=p.KeyframeReached:connect(Z)end end;Z=function(a0)pcall(function()if a0=="End"then a8(o,0.0,FakeHum)end end)end;local function aa()local V=o;if r~=nil then r:disconnect()end;o=""q=nil;if p~=nil then p:Stop()p:Destroy()p=nil end;return V end;local function ab()if b then i="Dead"end end;local function ac()if b then i="GettingUp"end end;local function ad()if b then i="FallingDown"end end;local function ae()if b then i="Seated"end end;local function af()if b then i="PlatformStanding"end end;local function ag(X)if b then if X>0.01 then Y("walk",0.1,FakeHum)i="Running"if k and k.AnimationId=="http://www.roblox.com/asset/?id=180426354"then W(X/14.5)end else if D[j]==nil then Y("idle",0.1,FakeHum)i="Standing"end end end end;local function ah()if b then Y("jump",0.1,FakeHum)v=w;i="Jumping"end end;local function ai(X)if b then Y("climb",0.1,FakeHum)W(X/12.0)i="Climbing"end end;local function aj()if b then if v<=0 then Y("fall",y,FakeHum)end;i="FreeFall"end end;local function ak(X)if b then i=X>=0 and"Running"or"Standing"end end;local function al()for I,am in ipairs(FakeRig:GetChildren())do if am.className=="Tool"then return am end end;return nil end;local function an(ao)for I,ap in ipairs(ao:GetChildren())do if ap.Name=="toolanim"and ap.className=="StringValue"then return ap end end;return nil end;local function aq()if b then if t=="None"then a8("toolnone",x,FakeHum,Enum.AnimationPriority.Idle)return end;if t=="Slash"then a8("toolslash",0,FakeHum,Enum.AnimationPriority.Action)return end;if t=="Lunge"then a8("toollunge",0,FakeHum,Enum.AnimationPriority.Action)return end end end;local function ar()c.MaxVelocity=0.15;d.MaxVelocity=0.15;c:SetDesiredAngle(3.14/2)d:SetDesiredAngle(-3.14/2)e:SetDesiredAngle(3.14/2)f:SetDesiredAngle(-3.14/2)end;local function as(A)local at=1;local au=1;local av=A-s;s=A;local aw=0;local ax=false;if v>0 then v=v-av end;if i=="FreeFall"and v<=0 then Y("fall",y,FakeHum)elseif i=="Seated"then Y("sit",0.5,FakeHum)return elseif i=="Running"then Y("walk",0.1,FakeHum)elseif i=="Dead"or i=="GettingUp"or i=="FallingDown"or i=="Seated"or i=="PlatformStanding"then U()at=0.1;au=1;ax=true end;if ax then local ay=at*Sin(A*au)c:SetDesiredAngle(ay+aw)d:SetDesiredAngle(ay-aw)e:SetDesiredAngle(-ay)f:SetDesiredAngle(-ay)end;local ao=al()if ao and ao:FindFirstChild("Handle")then local az=an(ao)if az then t=az.Value;az.Parent=nil;u=A+.3 end;if A>u then u=0;t="None"end;aq()else aa()t="None"q=nil;u=0 end end;FakeHum.Died:connect(ab)FakeHum.Running:connect(ag)FakeHum.Jumping:connect(ah)FakeHum.Climbing:connect(ai)FakeHum.GettingUp:connect(ac)FakeHum.FreeFalling:connect(aj)FakeHum.FallingDown:connect(ad)FakeHum.Seated:connect(ae)FakeHum.PlatformStanding:connect(af)FakeHum.Swimming:connect(ak)local aA=string.sub;TInsert(Events,LocalPlayer.Chatted:Connect(function(aB)local aC=""if aB=="/e dance"then aC=C[Random(1,#C)]elseif aA(aB,1,3)=="/e "then aC=aA(aB,4)elseif aA(aB,1,7)=="/emote "then aC=aA(aB,8)end;if i=="Standing"and D[aC]~=nil then Y(aC,0.1,FakeHum)end end))Y("idle",0.1,FakeHum)i="Standing"while IsAlive do b=a and a.Parent and a.Enabled or false;A=Wait(0.1)as(A)end end)
end

Spawn(function()repeat Wait()until Camera.CameraSubject==FakeHum;local a=Color3.fromRGB;local b=UDim2.new;local c=IN("Frame")local d=IN("ScreenGui")do local e=IN("UICorner")local f=IN("TextLabel")local g=IN("TextLabel")local h=IN("UITextSizeConstraint")local i=IN("TextLabel")local j=IN("UITextSizeConstraint")local k=IN("TextButton")local l=IN("UICorner")local m=IN("TextLabel")local n=IN("UITextSizeConstraint")d.Name="Main"d.Parent=game:GetService("CoreGui")c.Parent=d;c.BackgroundColor3=a(38,38,38)c.Position=b(0.738310993,0,1.2,0)c.Size=b(0.252637774,0,0.160366148,0)e.CornerRadius=UDim.new(0,2)e.Name="Corner"e.Parent=c;f.Parent=c;f.BackgroundColor3=a(255,255,255)f.BackgroundTransparency=1.000;f.Position=b(0.130384654,0,0.0649351403,0)f.Size=b(0.73430407,0,0.178190455,0)f.Font=Enum.Font.Gotham;f.Text="Reanimated! (Version 1.1.0)"f.TextColor3=a(243,243,243)f.TextScaled=true;f.TextSize=14.000;f.TextWrapped=true;g.Parent=c;g.BackgroundColor3=a(255,255,255)g.BackgroundTransparency=1.000;g.Position=b(0.0712678283,0,0.449823439,0)g.Size=b(0.840714335,0,0.187152565,0)g.Font=Enum.Font.Gotham;g.Text="Execution Speed: "..tostring(tick()-LoadSpeed)g.TextColor3=a(134,134,134)g.TextScaled=true;g.TextSize=14.000;g.TextWrapped=true;h.Parent=g;h.MaxTextSize=25;i.Parent=c;i.BackgroundColor3=a(255,255,255)i.BackgroundTransparency=1.000;i.Position=b(0.04762109,0,0.280025691,0)i.Size=b(0.891948998,0,0.178190455,0)i.Font=Enum.Font.Gotham;i.Text="Reanimate by: Gelatek"i.TextColor3=a(243,243,243)i.TextScaled=true;i.TextSize=14.000;i.TextWrapped=true;j.Parent=i;j.MaxTextSize=25;k.Parent=c;k.BackgroundColor3=a(74,120,60)k.Position=b(0.130057022,0,0.72707963,0)k.Size=b(0.734630048,0,0.188472986,0)k.ZIndex=2;k.Font=Enum.Font.Gotham;k.Text=" "k.TextColor3=a(0,0,0)k.TextScaled=true;k.TextSize=14.000;k.TextWrapped=true;l.CornerRadius=UDim.new(0,2)l.Name="Corner"l.Parent=k;m.Parent=k;m.BackgroundColor3=a(255,255,255)m.BackgroundTransparency=1.000;m.Position=b(0.0712679401,0,0.110013887,0)m.Size=b(0.870017171,0,0.743721008,0)m.ZIndex=2;m.Font=Enum.Font.Gotham;m.Text="Copy Discord Invite"m.TextColor3=a(255,255,255)m.TextScaled=true;m.TextSize=14.000;m.TextWrapped=true;n.Parent=m;n.MaxTextSize=25;k.MouseButton1Down:Once(function()if setclipboard then setclipboard("https://discord.gg/A7VexVaZDA")end;m.Text="Copied to clipboard!"end)end;c:TweenPosition(b(0.738310993,0,0.823268235,0),Enum.EasingDirection.InOut,Enum.EasingStyle.Quint,1)Wait(5)c:TweenPosition(b(0.738310993,0,1.2,0),Enum.EasingDirection.InOut,Enum.EasingStyle.Quint,1)Wait(1.4)c:Destroy()end)
